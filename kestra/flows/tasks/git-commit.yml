id: git-commit
namespace: fire.flow.tasks

description: |
  Atomic task: Stage all changes and commit.

  Pattern: Single git operation, returns success/failure.

inputs:
  - id: working_dir
    type: STRING
    defaults: /home/lewis/src/Fire-Flow
  - id: message
    type: STRING
    defaults: "TCR: Auto-commit (tests passing)"

tasks:
  - id: commit
    type: io.kestra.plugin.scripts.shell.Commands
    taskRunner:
      type: io.kestra.plugin.core.runner.Process
    commands:
      - |
        cd "{{ inputs.working_dir }}"

        # Stage all changes
        git add -A

        # Check if there's anything to commit
        if git diff --cached --quiet; then
          echo "Nothing to commit"
          exit 0
        fi

        # Commit with message
        git commit -m "{{ inputs.message }}"

        echo "Committed successfully"
        git log --oneline -1
