id: git-revert
namespace: fire.flow.tasks

description: |
  Atomic task: Revert all uncommitted changes.

  Pattern: Single git operation, returns success/failure.
  Used when tests fail in TCR cycle.

inputs:
  - id: working_dir
    type: STRING
    defaults: /home/lewis/src/Fire-Flow

tasks:
  - id: revert
    type: io.kestra.plugin.scripts.shell.Commands
    taskRunner:
      type: io.kestra.plugin.core.runner.Process
    commands:
      - |
        cd "{{ inputs.working_dir }}"

        # Show what will be reverted
        echo "Reverting changes:"
        git status --short

        # Hard reset to HEAD
        git reset --hard HEAD

        # Clean untracked files
        git clean -fd

        echo "Reverted to HEAD"
        git log --oneline -1
