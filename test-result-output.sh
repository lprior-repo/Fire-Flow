#!/bin/bash

# Test script to demonstrate the result.json output format for OpenCode
echo "Testing result.json output format for OpenCode integration..."

# Change to project directory
cd /home/lewis/src/Fire-Flow

# Remove any existing result file
rm -f result.json

# Run the TCR workflow logic manually to simulate what OpenCode would do
echo "Simulating TCR enforcement workflow execution..."

# Check current state
echo "Current state:"
./bin/fire-flow status

# Run TDD gate - should be allowed in RED state
echo "Running TDD gate check:"
./bin/fire-flow tdd-gate --file test_integration.go

# Run tests to update state
echo "Running tests:"
./bin/fire-flow run-tests --json

# Show the result.json that would be generated by the Kestra workflow
echo "Checking if result.json was created:"
if [ -f "result.json" ]; then
    echo "result.json content:"
    cat result.json
else
    echo "result.json not created - this is expected in CLI mode"
fi

echo "OpenCode result format test completed."